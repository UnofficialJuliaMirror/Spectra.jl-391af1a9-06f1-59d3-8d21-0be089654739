
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A Julia library to help treating spectroscopic data.">
      
      
      
        <meta name="author" content="Charles Le Losq">
      
      
        <link rel="shortcut icon" href="../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.7.1">
    
    
      
        <title>Peak Fitting - Spectra.jl</title>
      
    
    
      <script src="../assets/javascripts/modernizr-1df76c4e58.js"></script>
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application-f98ca285f9.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-8817cfa535.palette.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../assets/Documenter.css">
    
    
  </head>
  
  
  
  
    <body data-md-color-primary="indigo" data-md-color-accent="blue">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href=".." title="Spectra.jl" class="md-icon md-icon--home md-header-nav__button">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
            
            Peak Fitting
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">close</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result" data-md-lang-search="">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <div class="md-header-nav__source">
          
            


  


  <a href="https://github.com/charlesll/Spectra.jl" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          
        </div>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-icon md-icon--home md-nav__button"></i>
    
    Spectra.jl
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/charlesll/Spectra.jl" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Installation/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../PreProcessing/" title="Pre-Processing" class="md-nav__link">
      Pre-Processing
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../GeneralFunctions/" title="General Functions" class="md-nav__link">
      General Functions
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Rameau/" title="Rameau" class="md-nav__link">
      Rameau
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../MLregressor/" title="Machine Learning Regression" class="md-nav__link">
      Machine Learning Regression
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Peak Fitting
      </label>
    
    <a href="./" title="Peak Fitting" class="md-nav__link md-nav__link--active">
      Peak Fitting
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#model-adjustment" title="Model adjustment" class="md-nav__link">
    Model adjustment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-calculation-with-bootstrapping" title="error calculation with bootstrapping" class="md-nav__link">
    error calculation with bootstrapping
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Tutorial/" title="Tutorial" class="md-nav__link">
      Tutorial
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Tips/" title="Tips" class="md-nav__link">
      Tips
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ToDo/" title="Todo" class="md-nav__link">
      Todo
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../References/" title="References" class="md-nav__link">
      References
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#model-adjustment" title="Model adjustment" class="md-nav__link">
    Model adjustment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-calculation-with-bootstrapping" title="error calculation with bootstrapping" class="md-nav__link">
    error calculation with bootstrapping
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/charlesll/Spectra.jl/edit/master/docs/PeakFitting.md" title="Edit this page" class="md-icon md-content__icon">edit</a>
                
                
                <p><a id='Peak-fitting-1'></a></p>
<h1 id="peak-fitting">Peak fitting</h1>
<p><a id='Model-adjustment-1'></a></p>
<h2 id="model-adjustment">Model adjustment</h2>
<p>Peak fitting is done with the JuMP framework (https://jump.readthedocs.org/en/latest/). Spectra.jl actually does not provide any peak fitting capacities by itself, but the combination of its functionality with JuMP helps making fitting procedure quite easy. An example is visible in the example section of Spectra.jl. </p>
<p>One goal of Spectra is to promote the use of global optimisation models, where peak parameters are actually calculated from variation in other parameters (chemistry, temperature, etc.), or are shared between several spectra. I will provide very soon an example of such an approach. It can be implemented in a few lines of code with combining Spectra and JuMP, and has the advantage of greatly reducing the errors of the fits.</p>
<p><a id='error-calculation-with-bootstrapping-1'></a></p>
<h2 id="error-calculation-with-bootstrapping">error calculation with bootstrapping</h2>
<p>Error calculation can be done with using bootstrapping. Spectra provides a function that allows generating K new datasetes, by resampling the existing dataset in a non-parametric or parametric way. </p>
<p><a id='Spectra.bootsample-Tuple{Array{Float64,N},Array{Float64,N}}' href='#Spectra.bootsample-Tuple{Array{Float64,N},Array{Float64,N}}'>#</a>
<strong><code>Spectra.bootsample</code></strong> &mdash; <em>Method</em>.</p>
<div class="codehilite"><pre><span></span><span class="nt">bootsample</span><span class="o">(</span><span class="nt">x</span><span class="p">::</span><span class="nd">Array</span><span class="p">{</span><span class="err">Float64</span><span class="p">}</span><span class="o">,</span> <span class="nt">y</span><span class="p">::</span><span class="nd">Array</span><span class="p">{</span><span class="err">Float64</span><span class="p">}</span><span class="o">;</span> <span class="nt">boottype</span><span class="p">::</span><span class="nd">String</span> <span class="o">=</span> <span class="s2">&quot;np&quot;</span><span class="o">,</span> <span class="nt">ese</span><span class="p">::</span><span class="nd">Array</span><span class="p">{</span><span class="err">Float64</span><span class="p">}</span> <span class="o">=</span> <span class="cp">[</span><span class="mf">0.0</span><span class="cp">]</span><span class="o">)</span>
</pre></div>


<p>INPUTS</p>
<div class="codehilite"><pre><span></span><span class="n">x</span><span class="o">:</span> <span class="n">Array</span><span class="o">{</span><span class="n">Float64</span><span class="o">},</span> <span class="n">the</span> <span class="n">x</span> <span class="n">axis</span><span class="o">.</span> <span class="n">It</span> <span class="n">can</span> <span class="n">have</span> <span class="n">multiple</span> <span class="n">columns</span><span class="o">.</span>

<span class="n">y</span><span class="o">:</span> <span class="n">Array</span><span class="o">{</span><span class="n">Float64</span><span class="o">},</span> <span class="n">the</span> <span class="n">y</span> <span class="n">axis</span><span class="o">.</span> <span class="n">It</span> <span class="n">can</span> <span class="n">have</span> <span class="n">multiple</span> <span class="n">columns</span><span class="o">.</span>
</pre></div>


<p>OPTIONS</p>
<div class="codehilite"><pre><span></span><span class="n">boottype</span><span class="o">:</span> <span class="n">ASCIIString</span><span class="o">,</span> <span class="n">either</span> <span class="s2">&quot;np&quot;</span> <span class="n">or</span> <span class="s2">&quot;p&quot;</span><span class="o">,</span> <span class="k">this</span> <span class="k">is</span> <span class="n">the</span> <span class="n">type</span> <span class="n">of</span> <span class="n">bootstrapping</span> <span class="n">performed</span><span class="o">.</span> <span class="s2">&quot;np&quot;</span> <span class="n">performes</span> <span class="n">a</span> <span class="n">non</span><span class="o">-</span><span class="n">parametric</span> <span class="n">resampling</span> <span class="n">fo</span> <span class="n">the</span> <span class="n">dataset</span> <span class="k">with</span> <span class="n">replacement</span><span class="o">.</span> <span class="s2">&quot;p&quot;</span> <span class="n">performs</span> <span class="n">a</span> <span class="n">parametric</span> <span class="n">resampling</span><span class="o">.</span> <span class="n">The</span> <span class="n">data</span> <span class="n">are</span> <span class="n">resample</span> <span class="n">from</span> <span class="n">a</span> <span class="n">gaussian</span> <span class="n">distribution</span> <span class="n">centered</span> <span class="n">on</span> <span class="n">the</span> <span class="n">y</span> <span class="n">values</span> <span class="k">with</span> <span class="n">errors</span> <span class="n">that</span> <span class="n">should</span> <span class="n">be</span> <span class="n">provided</span> <span class="k">in</span> <span class="n">the</span> <span class="n">ese</span> <span class="n">variable</span><span class="o">.</span>

<span class="n">ese</span><span class="o">:</span> <span class="n">Array</span><span class="o">{</span><span class="n">Float64</span><span class="o">},</span> <span class="n">containing</span> <span class="n">the</span> <span class="n">errors</span> <span class="n">affecting</span> <span class="n">the</span> <span class="n">y</span> <span class="n">values</span> <span class="n">that</span> <span class="n">are</span> <span class="n">used</span> <span class="n">during</span> <span class="n">parametric</span> <span class="n">bootstrapping</span><span class="o">.</span>
</pre></div>


<p>OUTPUTS</p>
<div class="codehilite"><pre><span></span><span class="n">b_x_f</span><span class="o">:</span> <span class="n">Array</span><span class="o">{</span><span class="n">Float64</span><span class="o">},</span> <span class="n">the</span> <span class="n">bootstrapped</span> <span class="n">x</span> <span class="n">values</span>

<span class="n">b_y_f</span><span class="o">:</span> <span class="n">Array</span><span class="o">{</span><span class="n">Float64</span><span class="o">},</span> <span class="n">the</span> <span class="n">bootstrapped</span> <span class="n">y</span> <span class="n">values</span>
</pre></div>


<p>The bootstrap function can be embedded in a for loop, and will each time produce a different dataset. Performing K times the bootstrapping and fitting each time the model will allow to estimate the error distribution on the peak parameters. This technic has the advantage of making no prior assumption on the probability distribution functions of parameters errors. However, it is  much more time consuming that using the covariance matrix.</p>
<p><a target='_blank' href='https://github.com/charlesll/Spectra.jl/tree/d80b712b23fc20c7e8ff0cbf97de5d1b304ce6e1/src/bootstrap.jl#L17-L41' class='documenter-source'>source</a><br></p>
<p><a id='Spectra.bootperf-Tuple{Array{Float64,N}}' href='#Spectra.bootperf-Tuple{Array{Float64,N}}'>#</a>
<strong><code>Spectra.bootperf</code></strong> &mdash; <em>Method</em>.</p>
<div class="codehilite"><pre><span></span><span class="nt">bootperf</span><span class="o">(</span><span class="nt">params_boot</span><span class="p">::</span><span class="nd">Array</span><span class="p">{</span><span class="err">Float64</span><span class="p">}</span><span class="o">;</span> <span class="nt">plotting</span><span class="p">::</span><span class="nd">String</span> <span class="o">=</span> <span class="s2">&quot;True&quot;</span><span class="o">,</span> <span class="nt">parameter</span><span class="p">::</span><span class="nd">Int64</span> <span class="o">=</span> <span class="nt">1</span><span class="o">,</span> <span class="nt">feature</span><span class="p">::</span><span class="nd">Int64</span> <span class="o">=</span> <span class="nt">1</span><span class="o">,</span> <span class="nt">histogram_step</span><span class="p">::</span><span class="nd">Int64</span> <span class="o">=</span> <span class="nt">100</span><span class="o">,</span> <span class="nt">savefigures</span><span class="p">::</span><span class="nd">String</span> <span class="o">=</span> <span class="s2">&quot;False&quot;</span><span class="o">,</span> <span class="nt">save_bootrecord</span><span class="p">::</span><span class="nd">String</span> <span class="o">=</span> <span class="s2">&quot;Boot_record.pdf&quot;</span><span class="o">,</span> <span class="nt">save_histogram</span><span class="p">::</span><span class="nd">String</span> <span class="o">=</span> <span class="s2">&quot;Boot_histogram.pdf&quot;</span><span class="o">)</span>
</pre></div>


<p>params_boot[i,j] or [i,j,k]: array with i the bootstrrap experiment, j the parameter and k the feature being calculated (e.g., a peak during peak fitting)</p>
<p>plotting: switch to plotting mode ("True") or not ("False"). If true, parameter and feature must be provided, otherwise an error message is returned. </p>
<p>histogram_step is an integer value to control the histogram X axis division.</p>
<p>savefigures: "True" or "False", explicit, save in the current working directory.</p>
<p>save_bootrecord: Name for the graphic showing the bootstrap mean and std evolutions, with extension.</p>
<p>save_histogram: Name for the graphic showing the histogram for the parameter and feature of interest, with extension.</p>
<p>RETURN: std_record, mean_record, the arrays recording how the standard deviation and mean of the parameters as a function of the bootstrap advance. </p>
<p><a target='_blank' href='https://github.com/charlesll/Spectra.jl/tree/d80b712b23fc20c7e8ff0cbf97de5d1b304ce6e1/src/bootstrap.jl#L62-L79' class='documenter-source'>source</a><br></p>
<p>For further details, see the following references</p>
<p>Efron, B. 1979. “Bootstrap Methods: Another Look at the Jackknife.” The Annals of Statistics 7 (1): 1–26.</p>
<p>Efron, Bradley. 1981. “Nonparametric Estimates of Standard Error: The Jackknife, the Bootstrap and Other Methods.” Biometrika 68 (3): 589–99. doi:10.1093/biomet/68.3.589.</p>
<p>Efron, B., and Tibshirani, R. 1994. An Introduction to the Bootstrap. CRC press.</p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../MLregressor/" title="Machine Learning Regression" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Machine Learning Regression
              </span>
            </div>
          </a>
        
        
          <a href="../Tutorial/" title="Tutorial" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Tutorial
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application-e3caa82af6.js"></script>
      
      
      <script>app.initialize({url:{base:".."}})</script>
      
        <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
        <script src="../assets/mathjaxhelper.js"></script>
      
    
    
      
    
  </body>
</html>